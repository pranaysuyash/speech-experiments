#!/usr/bin/env bash
set -euo pipefail

repo_root="$(git rev-parse --show-toplevel)"
cd "$repo_root"

# 1. Agent gate: worklog enforcement + prohibited files
./scripts/agent_gate.sh --staged

# 2. Regression check: tests + builds
# Skip with SKIP_REGRESSION_CHECK=1 or --no-verify
if [[ "${SKIP_REGRESSION_CHECK:-}" != "1" ]]; then
    ./scripts/regression_check.sh --staged
else
    echo "[pre-commit] Skipping regression check (SKIP_REGRESSION_CHECK=1)"
fi
